<UserControl
  x:Class="KeyAsio.Views.Pages.AudioEnginePage"
  xmlns="https://github.com/avaloniaui"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:controls="using:KeyAsio.Views.Controls"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:suki="https://github.com/kikipoulet/SukiUI"
  xmlns:system="clr-namespace:System;assembly=System.Runtime"
  xmlns:vm="using:KeyAsio.ViewModels"
  x:DataType="vm:MainWindowViewModel"
  mc:Ignorable="d">

  <Design.DataContext>
    <vm:MainWindowViewModel />
  </Design.DataContext>

  <Grid>
    <ScrollViewer>
      <StackPanel Margin="{StaticResource PagePadding}" Spacing="{StaticResource SpacingLarge}">
        <suki:GlassCard>
          <suki:GroupBox Header="Backend Selection">
            <StackPanel Spacing="{StaticResource SpacingMedium}">
              <controls:SettingItem Header="Driver Type" Icon="DeveloperBoard">
                <controls:SettingItem.ActionContent>
                  <ComboBox
                    MinWidth="{StaticResource SettingControlWidthMedium}"
                    Classes="SettingItem"
                    ItemsSource="{Binding AudioSettings.AvailableDriverTypes}"
                    SelectedItem="{Binding AudioSettings.SelectedDriverType}" />
                </controls:SettingItem.ActionContent>
              </controls:SettingItem>

              <controls:SettingItem Header="Output Device" Icon="Speaker">
                <controls:SettingItem.ActionContent>
                  <ComboBox
                    MinWidth="{StaticResource SettingControlWidthLarge}"
                    Classes="SettingItem"
                    ItemsSource="{Binding AudioSettings.AvailableAudioDevices}"
                    SelectedItem="{Binding AudioSettings.SelectedAudioDevice}">
                    <ComboBox.ItemTemplate>
                      <DataTemplate>
                        <TextBlock Text="{Binding FriendlyName}" />
                      </DataTemplate>
                    </ComboBox.ItemTemplate>
                  </ComboBox>
                </controls:SettingItem.ActionContent>
              </controls:SettingItem>

              <controls:SettingItem Header="Sample Rate" Icon="Waveform">
                <controls:SettingItem.ActionContent>
                  <ComboBox
                    MinWidth="{StaticResource SettingControlWidthSmall}"
                    Classes="SettingItem"
                    ItemsSource="{Binding AudioSettings.SupportedSampleRates}"
                    SelectedItem="{Binding AudioSettings.SelectedSampleRate}" />
                </controls:SettingItem.ActionContent>
              </controls:SettingItem>
            </StackPanel>
          </suki:GroupBox>
        </suki:GlassCard>

        <suki:GlassCard>
          <suki:GroupBox Header="Latency &amp; Buffer">
            <StackPanel Spacing="{StaticResource SpacingLarge}">
              <StackPanel IsVisible="{Binding !AudioSettings.IsAsio}" Spacing="{StaticResource SpacingLarge}">
                <controls:SettingItem Header="Target Latency" Icon="TimerSand">
                  <controls:SettingItem.ActionContent>
                    <TextBlock Classes="Value" Text="{Binding AudioSettings.TargetBufferSize, StringFormat='{}{0} ms'}" />
                  </controls:SettingItem.ActionContent>
                </controls:SettingItem>
                <Slider
                  Classes="SettingItem"
                  Maximum="200"
                  Minimum="0"
                  Value="{Binding AudioSettings.TargetBufferSize}" />
              </StackPanel>

              <StackPanel IsVisible="{Binding AudioSettings.IsAsio}" Spacing="{StaticResource SpacingLarge}">
                <controls:SettingItem Header="Force Buffer Size" Icon="TimerSand">
                  <controls:SettingItem.ActionContent>
                    <TextBlock Classes="Value" Text="{Binding AudioSettings.ForceAsioBufferSize, StringFormat='{}{0} samples'}" />
                  </controls:SettingItem.ActionContent>
                </controls:SettingItem>
                <Slider
                  Classes="SettingItem"
                  Maximum="2048"
                  Minimum="0"
                  Value="{Binding AudioSettings.ForceAsioBufferSize}" />
              </StackPanel>

              <Separator Classes="Section" IsVisible="{Binding AudioSettings.IsWasapi}" />

              <controls:SettingItem
                Header="Exclusive Mode"
                Icon="Lock"
                IsVisible="{Binding AudioSettings.IsWasapi}">
                <controls:SettingItem.ActionContent>
                  <CheckBox IsChecked="{Binding AudioSettings.IsExclusiveMode}" />
                </controls:SettingItem.ActionContent>
              </controls:SettingItem>
            </StackPanel>
          </suki:GroupBox>
        </suki:GlassCard>

        <suki:GlassCard>
          <suki:GroupBox Header="Audio Processing">
            <controls:SettingItem
              Description="Prevents distortion when multiple hitsounds stack. Recommended to disable for faithful, raw audio. Requires more CPU resources. Disable if audio stutters."
              Header="Audio Limiter"
              Icon="Equalizer">
              <controls:SettingItem.ActionContent>
                <CheckBox IsChecked="{Binding AudioSettings.IsLimiterEnabled}" />
              </controls:SettingItem.ActionContent>
            </controls:SettingItem>
          </suki:GroupBox>
        </suki:GlassCard>

        <!--  Spacer for Floating Bar  -->
        <Border Height="80" />
      </StackPanel>
    </ScrollViewer>

    <!--  Floating Action Bar  -->
    <suki:GlassCard
      Margin="{StaticResource FloatingBarMargin}"
      Padding="{StaticResource CardPadding}"
      VerticalAlignment="Bottom"
      IsOpaque="True"
      IsVisible="{Binding AudioSettings.HasUnsavedAudioChanges}">
      <Grid ColumnDefinitions="*,Auto">
        <StackPanel
          VerticalAlignment="Center"
          Orientation="Horizontal"
          Spacing="{StaticResource SpacingSmall}">
          <materialIcons:MaterialIcon
            Width="{StaticResource IconSizeSmall}"
            Height="{StaticResource IconSizeSmall}"
            Kind="InformationOutline"
            Opacity="{StaticResource OpacityDisabled}" />
          <TextBlock
            VerticalAlignment="Center"
            Opacity="{StaticResource OpacityTertiary}"
            Text="Changes require application to take effect" />
        </StackPanel>
        <StackPanel
          Grid.Column="1"
          Orientation="Horizontal"
          Spacing="10">
          <Button Command="{Binding AudioSettings.DiscardAudioSettingsCommand}" Content="Discard" />
          <Button
            Classes="Flat"
            Command="{Binding AudioSettings.ApplyAudioSettingsCommand}"
            Content="Apply Settings" />
        </StackPanel>
      </Grid>
    </suki:GlassCard>
  </Grid>
</UserControl>
