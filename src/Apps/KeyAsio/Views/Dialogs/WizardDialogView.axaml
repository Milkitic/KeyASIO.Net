<UserControl
  x:Class="KeyAsio.Views.Dialogs.WizardDialogView"
  xmlns="https://github.com/avaloniaui"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:controls="using:KeyAsio.Views.Controls"
  xmlns:converters="using:KeyAsio.Converters"
  xmlns:dialogs="using:KeyAsio.Views.Dialogs"
  xmlns:lang="clr-namespace:KeyAsio.Lang"
  xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
  xmlns:suki="https://github.com/kikipoulet/SukiUI"
  xmlns:vm="using:KeyAsio.ViewModels"
  Width="760"
  Height="500"
  x:DataType="vm:WizardViewModel">
  <UserControl.Resources>
    <converters:I18NConverter x:Key="I18NConverter" />
  </UserControl.Resources>
  <Design.DataContext>
    <vm:WizardViewModel />
  </Design.DataContext>

  <Grid RowDefinitions="Auto,*,Auto">
    <!--  Header / Stepper  -->
    <suki:Stepper
      AlternativeStyle="True"
      Index="{Binding StepIndex}"
      Steps="{Binding Steps}" />

    <!--  Content  -->
    <Carousel
      Grid.Row="1"
      Margin="20"
      SelectedIndex="{Binding StepIndex}">
      <Carousel.PageTransition>
        <PageSlide Orientation="Horizontal" Duration="0.5" />
      </Carousel.PageTransition>

      <!--  Step 0: Welcome  -->

      <Grid
        HorizontalAlignment="Stretch"
        VerticalAlignment="Center"
        RowDefinitions="Auto,Auto,Auto,*"
        RowSpacing="20">
        <TextBlock
          Grid.Row="1"
          HorizontalAlignment="Center"
          Classes="h3"
          Text="{I18N {x:Static lang:SRKeys.Wizard_Welcome_Title}}" />
        <TextBlock
          Grid.Row="2"
          HorizontalAlignment="Center"
          Classes="h5"
          Opacity="0.7"
          Text="{I18N {x:Static lang:SRKeys.Wizard_Welcome_Subtitle}}" />
        <StackPanel
          Grid.Row="3"
          Margin="0,20,0,0"
          HorizontalAlignment="Center"
          Orientation="Horizontal"
          Spacing="30">
          <suki:GlassCard Width="180" Height="140">
            <StackPanel VerticalAlignment="Center" Spacing="10">
              <materialIcons:MaterialIcon
                Width="30"
                Height="30"
                Foreground="{DynamicResource SukiPrimaryColor}"
                Kind="LightningBolt" />
              <TextBlock
                Text="{I18N {x:Static lang:SRKeys.Wizard_Welcome_Feature1}}"
                TextAlignment="Center"
                TextWrapping="Wrap" />
            </StackPanel>
          </suki:GlassCard>
          <suki:GlassCard Width="180" Height="140">
            <StackPanel VerticalAlignment="Center" Spacing="10">
              <materialIcons:MaterialIcon
                Width="30"
                Height="30"
                Foreground="{DynamicResource SukiPrimaryColor}"
                Kind="Sync" />
              <TextBlock
                Text="{I18N {x:Static lang:SRKeys.Wizard_Welcome_Feature2}}"
                TextAlignment="Center"
                TextWrapping="Wrap" />
            </StackPanel>
          </suki:GlassCard>
          <suki:GlassCard Width="180" Height="140">
            <StackPanel VerticalAlignment="Center" Spacing="10">
              <materialIcons:MaterialIcon
                Width="30"
                Height="30"
                Foreground="{DynamicResource SukiPrimaryColor}"
                Kind="Tune" />
              <TextBlock
                Text="{I18N {x:Static lang:SRKeys.Wizard_Welcome_Feature3}}"
                TextAlignment="Center"
                TextWrapping="Wrap" />
            </StackPanel>
          </suki:GlassCard>
        </StackPanel>
      </Grid>

      <!--  Step 1: Preset Selection  -->
      <Grid>
        <StackPanel Spacing="20">
          <TextBlock
            HorizontalAlignment="Center"
            Classes="h3"
            Text="{I18N {x:Static lang:SRKeys.Preset_SelectionTitle}}" />
          <dialogs:PresetSelectionDialog DataContext="{Binding PresetSelectionViewModel}" />
        </StackPanel>
      </Grid>

      <!--  Step 2: Game Integration (osu!)  -->
      <Grid>
        <StackPanel
          Width="550"
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Spacing="20">
          <TextBlock
            HorizontalAlignment="Center"
            Classes="h3"
            Text="连接 osu!" />
          <suki:GlassCard Padding="0">
            <StackPanel>
              <!--  Status Section  -->
              <Grid Margin="20" ColumnDefinitions="Auto,*,Auto">
                <Panel>
                  <Border
                    Width="48"
                    Height="48"
                    Background="{DynamicResource SukiPrimaryColor}"
                    CornerRadius="12"
                    Opacity="0.1" />
                  <materialIcons:MaterialIcon
                    Width="24"
                    Height="24"
                    Foreground="{DynamicResource SukiPrimaryColor}"
                    Kind="GamepadVariant" />
                </Panel>

                <StackPanel
                  Grid.Column="1"
                  Margin="15,0"
                  VerticalAlignment="Center"
                  Spacing="4">
                  <TextBlock FontWeight="DemiBold" Text="游戏集成状态" />
                  <TextBlock
                    FontSize="13"
                    Opacity="0.7"
                    Text="{Binding OsuScanStatus}"
                    TextTrimming="CharacterEllipsis" />
                </StackPanel>

                <Button
                  Grid.Column="2"
                  VerticalAlignment="Center"
                  Classes="Flat"
                  Command="{Binding BrowseOsuExecutableCommand}">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <materialIcons:MaterialIcon
                      Width="16"
                      Height="16"
                      Kind="FolderSearchOutline" />
                    <TextBlock Text="选择路径" />
                  </StackPanel>
                </Button>
              </Grid>

              <Separator
                Height="1"
                Margin="20,0"
                Background="{DynamicResource SukiControlBorderBrush}"
                Opacity="0.2" />

              <!--  Settings Section  -->
              <Grid Margin="20" ColumnDefinitions="*,Auto">
                <StackPanel VerticalAlignment="Center" Spacing="4">
                  <TextBlock FontWeight="DemiBold" Text="{I18N {x:Static lang:SRKeys.Sync_AutoLoadSkins}}" />
                  <TextBlock
                    FontSize="12"
                    Opacity="0.6"
                    Text="自动读取并应用游戏内的皮肤音效" />
                </StackPanel>
                <ToggleSwitch Grid.Column="1" IsChecked="{Binding AppSettings.Paths.AllowAutoLoadSkins}" />
              </Grid>
            </StackPanel>
          </suki:GlassCard>
        </StackPanel>
      </Grid>

      <!--  Step 3: Audio Configuration  -->
      <Grid>
        <controls:WizardAudioConfigView DataContext="{Binding WizardAudioConfigViewModel}" />
      </Grid>

      <!--  Step 4: Privacy  -->
      <Grid>
        <StackPanel
          Width="400"
          HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Spacing="20">
          <TextBlock
            HorizontalAlignment="Center"
            Classes="h2"
            Text="{I18N {x:Static lang:SRKeys.Wizard_Privacy_Title}}" />
          <suki:GlassCard>
            <StackPanel Spacing="10">
              <CheckBox Content="{I18N {x:Static lang:SRKeys.Wizard_Privacy_CrashReport}}" IsChecked="{Binding EnableCrashReport}" />
              <CheckBox Content="{I18N {x:Static lang:SRKeys.Wizard_Privacy_CheckUpdates}}" IsChecked="{Binding EnableUpdates}" />
            </StackPanel>
          </suki:GlassCard>
        </StackPanel>
      </Grid>
    </Carousel>

    <!--  Footer  -->
    <StackPanel
      Grid.Row="2"
      HorizontalAlignment="Right"
      Orientation="Horizontal"
      Spacing="10">
      <Button
        Classes="Flat"
        Command="{Binding SkipCommand}"
        Content="{I18N {x:Static lang:SRKeys.Wizard_Skip}}" />
      <Button
        Command="{Binding PreviousCommand}"
        Content="{Binding PreviousButtonText, Converter={StaticResource I18NConverter}}"
        IsVisible="{Binding StepIndex, Converter={x:Static ObjectConverters.NotEqual}, ConverterParameter=0}" />
      <Button
        Classes="Flat Primary"
        Command="{Binding NextCommand}"
        Content="{Binding NextButtonText, Converter={StaticResource I18NConverter}}" />
    </StackPanel>
  </Grid>
</UserControl>
