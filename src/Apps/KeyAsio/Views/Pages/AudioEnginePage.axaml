<UserControl
  x:Class="KeyAsio.Views.Pages.AudioEnginePage"
  xmlns="https://github.com/avaloniaui"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:controls="using:KeyAsio.Views.Controls"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:lang="clr-namespace:KeyAsio.Lang"
  xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:suki="https://github.com/kikipoulet/SukiUI"
  xmlns:system="clr-namespace:System;assembly=System.Runtime"
  xmlns:vm="using:KeyAsio.ViewModels"
  x:DataType="vm:MainWindowViewModel"
  mc:Ignorable="d">

  <Design.DataContext>
    <vm:MainWindowViewModel />
  </Design.DataContext>

  <Grid>
    <ScrollViewer>
      <StackPanel Margin="{StaticResource PagePadding}" Spacing="{StaticResource SpacingLarge}">
        <suki:GlassCard>
          <suki:GroupBox Header="{I18N {x:Static lang:SRKeys.Audio_BackendSelection}}">
            <StackPanel Spacing="{StaticResource SpacingMedium}">
              <controls:SettingItem Header="{I18N {x:Static lang:SRKeys.Audio_DriverType}}" Icon="DeveloperBoard">
                <ComboBox
                  MinWidth="{StaticResource SettingControlWidthMedium}"
                  Classes="SettingItem"
                  ItemsSource="{Binding AudioSettings.AvailableDriverTypes}"
                  SelectedItem="{Binding AudioSettings.SelectedDriverType}" />
              </controls:SettingItem>

              <controls:SettingItem Header="{I18N {x:Static lang:SRKeys.Audio_OutputDevice}}" Icon="Speaker">
                <ComboBox
                  MinWidth="{StaticResource SettingControlWidthLarge}"
                  Classes="SettingItem"
                  ItemsSource="{Binding AudioSettings.AvailableAudioDevices}"
                  SelectedItem="{Binding AudioSettings.SelectedAudioDevice}">
                  <ComboBox.ItemTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding FriendlyName}" />
                    </DataTemplate>
                  </ComboBox.ItemTemplate>
                </ComboBox>
              </controls:SettingItem>

              <controls:SettingItem Header="{I18N {x:Static lang:SRKeys.Audio_SampleRate}}" Icon="Waveform">
                <ComboBox
                  MinWidth="{StaticResource SettingControlWidthSmall}"
                  Classes="SettingItem"
                  ItemsSource="{Binding AudioSettings.SupportedSampleRates}"
                  SelectedItem="{Binding AudioSettings.SelectedSampleRate}" />
              </controls:SettingItem>
            </StackPanel>
          </suki:GroupBox>
        </suki:GlassCard>

        <suki:GlassCard>
          <suki:GroupBox Header="{I18N {x:Static lang:SRKeys.Audio_LatencyAndBuffer}}">
            <StackPanel Spacing="{StaticResource SpacingLarge}">
              <StackPanel IsVisible="{Binding !AudioSettings.IsAsio}" Spacing="{StaticResource SpacingLarge}">
                <controls:SettingItem Header="{I18N {x:Static lang:SRKeys.Audio_TargetLatency}}" Icon="TimerSand">
                  <TextBlock Classes="Value" Text="{Binding AudioSettings.TargetBufferSize, StringFormat='{}{0} ms'}" />
                </controls:SettingItem>
                <Slider
                  Classes="SettingItem"
                  Maximum="200"
                  Minimum="0"
                  Value="{Binding AudioSettings.TargetBufferSize}" />
              </StackPanel>

              <StackPanel IsVisible="{Binding AudioSettings.IsAsio}" Spacing="{StaticResource SpacingLarge}">
                <controls:SettingItem Header="{I18N {x:Static lang:SRKeys.Audio_ForceBufferSize}}" Icon="TimerSand">
                  <TextBlock Classes="Value" Text="{Binding AudioSettings.ForceAsioBufferSize, StringFormat='{}{0} samples'}" />
                </controls:SettingItem>
                <Slider
                  Classes="SettingItem"
                  Maximum="2048"
                  Minimum="0"
                  Value="{Binding AudioSettings.ForceAsioBufferSize}" />
              </StackPanel>

              <Separator Classes="Section" IsVisible="{Binding AudioSettings.IsWasapi}" />

              <controls:SettingItem
                Header="{I18N {x:Static lang:SRKeys.Audio_ExclusiveMode}}"
                Icon="Lock"
                IsVisible="{Binding AudioSettings.IsWasapi}">
                <CheckBox IsChecked="{Binding AudioSettings.IsExclusiveMode}" />
              </controls:SettingItem>
            </StackPanel>
          </suki:GroupBox>
        </suki:GlassCard>

        <suki:GlassCard>
          <suki:GroupBox Header="{I18N {x:Static lang:SRKeys.Audio_Processing}}">
            <controls:SettingItem
              Description="{I18N {x:Static lang:SRKeys.Audio_LimiterDescription}}"
              Header="{I18N {x:Static lang:SRKeys.Audio_Limiter}}"
              Icon="Equalizer">
              <CheckBox IsChecked="{Binding AudioSettings.IsLimiterEnabled}" />
            </controls:SettingItem>
          </suki:GroupBox>
        </suki:GlassCard>

        <!--  Spacer for Floating Bar  -->
        <Border Height="80" />
      </StackPanel>
    </ScrollViewer>

    <!--  Floating Action Bar  -->
    <suki:GlassCard
      Margin="{StaticResource FloatingBarMargin}"
      Padding="{StaticResource CardPadding}"
      VerticalAlignment="Bottom"
      IsOpaque="True"
      IsVisible="{Binding AudioSettings.HasUnsavedAudioChanges}">
      <Grid ColumnDefinitions="*,Auto">
        <StackPanel
          VerticalAlignment="Center"
          Orientation="Horizontal"
          Spacing="{StaticResource SpacingSmall}">
          <materialIcons:MaterialIcon
            Width="{StaticResource IconSizeSmall}"
            Height="{StaticResource IconSizeSmall}"
            Kind="InformationOutline"
            Opacity="{StaticResource OpacityDisabled}" />
          <TextBlock
            VerticalAlignment="Center"
            Opacity="{StaticResource OpacityTertiary}"
            Text="{I18N {x:Static lang:SRKeys.Message_RestartRequired}}" />
        </StackPanel>
        <StackPanel
          Grid.Column="1"
          Orientation="Horizontal"
          Spacing="10">
          <Button Command="{Binding AudioSettings.DiscardAudioSettingsCommand}" Content="{I18N {x:Static lang:SRKeys.Common_Discard}}" />
          <Button
            Classes="Flat"
            Command="{Binding AudioSettings.ApplyAudioSettingsCommand}"
            Content="{I18N {x:Static lang:SRKeys.Settings_Apply}}" />
        </StackPanel>
      </Grid>
    </suki:GlassCard>
  </Grid>
</UserControl>
