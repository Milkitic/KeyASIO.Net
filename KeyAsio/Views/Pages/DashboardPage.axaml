<UserControl
  x:Class="KeyAsio.Views.Pages.DashboardPage"
  xmlns="https://github.com/avaloniaui"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:suki="https://github.com/kikipoulet/SukiUI"
  xmlns:vm="using:KeyAsio.ViewModels"
  xmlns:audio="clr-namespace:KeyAsio.Audio;assembly=KeyAsio.Audio"
  xmlns:converters="using:KeyAsio.Converters"
  x:DataType="vm:MainWindowViewModel"
  mc:Ignorable="d">

  <UserControl.Resources>
      <converters:EnumEqualityConverter x:Key="EnumEqualityConverter" />
  </UserControl.Resources>

  <Design.DataContext>
    <vm:MainWindowViewModel />
  </Design.DataContext>

  <Grid Margin="20" RowDefinitions="Auto,*,Auto">

    <!--  Top: Switcher  -->
    <suki:GlassCard Margin="0,0,0,15" Classes="Surface">
      <Grid ColumnDefinitions="*,Auto">
        <StackPanel
          VerticalAlignment="Center"
          Orientation="Horizontal"
          Spacing="10">
          <materialIcons:MaterialIcon Foreground="{DynamicResource SukiPrimaryColor}" Kind="LightningBolt" />
          <TextBlock
            VerticalAlignment="Center"
            FontWeight="DemiBold"
            Text="Engine Status" />
        </StackPanel>
        <ToggleSwitch
          Grid.Column="1"
          IsChecked="{Binding AppSettings.Realtime.RealtimeMode}"
          OffContent="Key Only"
          OnContent="Sync Mode" />
      </Grid>
    </suki:GlassCard>

    <!--  Center: The Core (Sphere visualization)  -->
    <Grid
      Grid.Row="1"
      HorizontalAlignment="Center"
      VerticalAlignment="Center">
      <!--  Outer Glow Ring (Simulated with Border/Shadow)  -->
      <Border
        Width="220"
        Height="220"
        BorderBrush="{DynamicResource SukiPrimaryColor}"
        BorderThickness="2"
        CornerRadius="150"
        Opacity="0.2">
        <Border.Effect>
          <BlurEffect Radius="20" />
        </Border.Effect>
      </Border>

      <!--  Main Sphere  -->
      <suki:GlassCard
        Width="200"
        Height="200"
        BorderThickness="0"
        CornerRadius="100">
        <Grid>
          <Border
            Background="{DynamicResource SukiPrimaryColor}"
            CornerRadius="100"
            Opacity="0.1" />
          <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
            <materialIcons:MaterialIcon
              Width="48"
              Height="48"
              Foreground="{DynamicResource SukiPrimaryColor}"
              Kind="LinkVariant" />
            <TextBlock
              HorizontalAlignment="Center"
              Classes="h2"
              FontWeight="Bold"
              Foreground="{DynamicResource SukiText}"
              Text="SYNCED" />
            <TextBlock
              HorizontalAlignment="Center"
              Classes="Caption"
              Opacity="0.6"
              Text="ID: 14022" />
          </StackPanel>
        </Grid>
      </suki:GlassCard>
    </Grid>

    <!--  Bottom: Stats & Quick Keys  -->
    <Grid
      Grid.Row="2"
      Grid.ColumnSpan="2"
      Margin="0,20,0,0"
      ColumnDefinitions="*,*">
      <!--  Stats  -->
      <suki:GlassCard Margin="0,0,10,0" Padding="15">
        <StackPanel Spacing="10">
            <StackPanel Orientation="Horizontal" Spacing="10">
                <materialIcons:MaterialIcon Kind="Speaker" Foreground="{DynamicResource SukiPrimaryColor}" />
                <TextBlock Text="Audio Device" FontWeight="Bold" />
            </StackPanel>
          
            <!-- No Device -->
            <TextBlock Text="No device selected." 
                       IsVisible="{Binding AppSettings.Audio.PlaybackDevice, Converter={x:Static ObjectConverters.IsNull}}"
                       Foreground="{DynamicResource SukiText}" Opacity="0.6"/>

            <!-- Device Fault -->
            <Button Command="{Binding ShowDeviceErrorCommand}"
                    IsVisible="{Binding AudioSettings.DeviceErrorMessage, Converter={x:Static ObjectConverters.IsNotNull}}"
                    Classes="Basic"
                    Padding="0"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Left">
                <StackPanel Spacing="5">
                    <StackPanel Orientation="Horizontal" Spacing="5">
                        <materialIcons:MaterialIcon Kind="AlertCircle" Foreground="{DynamicResource SukiDangerColor}" />
                        <TextBlock Text="Device Fault" FontWeight="Bold" Foreground="{DynamicResource SukiDangerColor}" />
                    </StackPanel>

                    <TextBlock Text="{Binding AppSettings.Audio.PlaybackDevice.FriendlyName}"
                               Foreground="{DynamicResource SukiDangerColor}"
                               Opacity="0.8"
                               TextTrimming="CharacterEllipsis" />

                    <TextBlock Text="{Binding AppSettings.Audio.PlaybackDevice.WavePlayerType}"
                               Foreground="{DynamicResource SukiDangerColor}"
                               Opacity="0.8" />
                </StackPanel>
            </Button>

            <!-- Device Info -->
            <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="Auto,*" 
                  IsVisible="{Binding AudioSettings.ActiveDeviceDescription, Converter={x:Static ObjectConverters.IsNotNull}}">
                
                <TextBlock Grid.Row="0" Grid.Column="0" Text="Name: " Opacity="0.6" Margin="0,0,10,5" />
                <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding AudioSettings.ActiveDeviceDescription.FriendlyName}" TextTrimming="CharacterEllipsis" Margin="0,0,0,5" />

                <TextBlock Grid.Row="1" Grid.Column="0" Text="Backend: " Opacity="0.6" Margin="0,0,10,5" />
                <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding AudioSettings.ActiveDeviceDescription.WavePlayerType}" Margin="0,0,0,5" />

                <TextBlock Grid.Row="2" Grid.Column="0" Text="Sample Rate: " Opacity="0.6" Margin="0,0,10,5" />
                <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding AudioSettings.AudioEngine.EngineWaveFormat.SampleRate, StringFormat='{}{0} Hz', FallbackValue='-'}" Margin="0,0,0,5" />

                <!-- WASAPI Exclusive -->
                <TextBlock Grid.Row="3" Grid.Column="0" Text="Exclusive: " Opacity="0.6" Margin="0,0,10,5"
                           IsVisible="{Binding AudioSettings.ActiveDeviceDescription.WavePlayerType, Converter={StaticResource EnumEqualityConverter}, ConverterParameter={x:Static audio:WavePlayerType.WASAPI}}" />
                <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding AudioSettings.ActiveDeviceDescription.IsExclusive}" Margin="0,0,0,5"
                           IsVisible="{Binding AudioSettings.ActiveDeviceDescription.WavePlayerType, Converter={StaticResource EnumEqualityConverter}, ConverterParameter={x:Static audio:WavePlayerType.WASAPI}}" />

                 <!-- Latency (WASAPI) -->
                <TextBlock Grid.Row="4" Grid.Column="0" Text="Latency: " Opacity="0.6" Margin="0,0,10,5"
                           IsVisible="{Binding AudioSettings.ActiveDeviceDescription.WavePlayerType, Converter={StaticResource EnumEqualityConverter}, ConverterParameter={x:Static audio:WavePlayerType.WASAPI}}" />
                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding AudioSettings.ActiveDeviceDescription.Latency, StringFormat='{}{0} ms'}" Margin="0,0,0,5"
                           IsVisible="{Binding AudioSettings.ActiveDeviceDescription.WavePlayerType, Converter={StaticResource EnumEqualityConverter}, ConverterParameter={x:Static audio:WavePlayerType.WASAPI}}" />

                <!-- Latency (DirectSound) -->
                <TextBlock Grid.Row="4" Grid.Column="0" Text="Latency: " Opacity="0.6" Margin="0,0,10,5"
                           IsVisible="{Binding AudioSettings.ActiveDeviceDescription.WavePlayerType, Converter={StaticResource EnumEqualityConverter}, ConverterParameter={x:Static audio:WavePlayerType.DirectSound}}" />
                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding AudioSettings.ActiveDeviceDescription.Latency, StringFormat='{}{0} ms'}" Margin="0,0,0,5"
                           IsVisible="{Binding AudioSettings.ActiveDeviceDescription.WavePlayerType, Converter={StaticResource EnumEqualityConverter}, ConverterParameter={x:Static audio:WavePlayerType.DirectSound}}" />

                <!-- ASIO Frames -->
                <TextBlock Grid.Row="4" Grid.Column="0" Text="Buffer: " Opacity="0.6" Margin="0,0,10,5"
                           IsVisible="{Binding AudioSettings.ActiveDeviceDescription.WavePlayerType, Converter={StaticResource EnumEqualityConverter}, ConverterParameter={x:Static audio:WavePlayerType.ASIO}}" />
                <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding AudioSettings.FramesPerBuffer, StringFormat='{}{0} samples'}" Margin="0,0,0,5"
                           IsVisible="{Binding AudioSettings.ActiveDeviceDescription.WavePlayerType, Converter={StaticResource EnumEqualityConverter}, ConverterParameter={x:Static audio:WavePlayerType.ASIO}}" />

                <!-- ASIO Latency -->
                <TextBlock Grid.Row="5" Grid.Column="0" Text="Latency: " Opacity="0.6" Margin="0,0,10,5"
                           IsVisible="{Binding AudioSettings.ActiveDeviceDescription.WavePlayerType, Converter={StaticResource EnumEqualityConverter}, ConverterParameter={x:Static audio:WavePlayerType.ASIO}}" />
                <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding AudioSettings.ActiveDeviceDescription.AsioLatencyMs, StringFormat='{}{0:F2} ms'}" Margin="0,0,0,5"
                           IsVisible="{Binding AudioSettings.ActiveDeviceDescription.WavePlayerType, Converter={StaticResource EnumEqualityConverter}, ConverterParameter={x:Static audio:WavePlayerType.ASIO}}" />
            </Grid>
        </StackPanel>
      </suki:GlassCard>

      <!--  Key Bindings  -->
      <suki:GlassCard
        Grid.Column="1"
        Margin="10,0,0,0"
        Padding="15">
        <Grid RowDefinitions="Auto,*">
          <DockPanel LastChildFill="False">
            <TextBlock FontWeight="Bold" Text="Quick Bindings" />
            <Button
              Width="24"
              Height="24"
              Margin="0,-6"
              Padding="0"
              Classes="Flat"
              DockPanel.Dock="Right">
              <materialIcons:MaterialIcon Kind="Plus" />
            </Button>
          </DockPanel>

          <Grid Grid.Row="1" ColumnDefinitions="*,Auto">
            <ScrollViewer
              Margin="0,10,0,0"
              HorizontalScrollBarVisibility="Auto"
              VerticalScrollBarVisibility="Disabled">
              <ItemsControl>
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <StackPanel
                      HorizontalAlignment="Left"
                      Orientation="Horizontal"
                      Spacing="10" />
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <!--  Mock Items  -->
                <suki:GlassCard
                  Width="42"
                  Height="42"
                  Padding="0"
                  CornerRadius="8">
                  <TextBlock
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="16"
                    FontWeight="Bold"
                    Text="Z" />
                </suki:GlassCard>
                <suki:GlassCard
                  Width="42"
                  Height="42"
                  Padding="0"
                  CornerRadius="8">
                  <TextBlock
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="16"
                    FontWeight="Bold"
                    Text="X" />
                </suki:GlassCard>
                <suki:GlassCard
                  Width="42"
                  Height="42"
                  Padding="0"
                  CornerRadius="8">
                  <TextBlock
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="16"
                    FontWeight="Bold"
                    Text="C" />
                </suki:GlassCard>
                <suki:GlassCard
                  Width="42"
                  Height="42"
                  Padding="0"
                  CornerRadius="8">
                  <TextBlock
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="16"
                    FontWeight="Bold"
                    Text="V" />
                </suki:GlassCard>
                <suki:GlassCard
                  Width="42"
                  Height="42"
                  Padding="0"
                  CornerRadius="8">
                  <TextBlock
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="16"
                    FontWeight="Bold"
                    Text="B" />
                </suki:GlassCard>
                <suki:GlassCard
                  Width="42"
                  Height="42"
                  Padding="0"
                  CornerRadius="8">
                  <TextBlock
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="16"
                    FontWeight="Bold"
                    Text="N" />
                </suki:GlassCard>
                <suki:GlassCard
                  Width="42"
                  Height="42"
                  Padding="0"
                  CornerRadius="8">
                  <TextBlock
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="16"
                    FontWeight="Bold"
                    Text="M" />
                </suki:GlassCard>
              </ItemsControl>
            </ScrollViewer>
          </Grid>
        </Grid>
      </suki:GlassCard>
    </Grid>
  </Grid>
</UserControl>
